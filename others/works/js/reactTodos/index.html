<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>todos</title>
<link rel="stylesheet" type="text/css" href="css/base.css">
<link rel="stylesheet" type="text/css" href="css/index.css">
</head>

<body>
<section class="todoapp" id="box">
</section>
<script src="js/react.js" type="text/javascript"></script>
<script src="js/react-dom.js" type="text/javascript"></script>
<script src="js/browser.min.js" type="text/javascript"></script>
<script type="text/babel">
	var data = [
		{
			id: new Date().getTime() + Math.random(),
			title:"代码搬运工",
			isChecked:true  //给这条数据加上一个字段，来表示这条数据是否被选中
		},
		{
			id: new Date().getTime() + Math.random(),
			title:"欢迎回来",
			isChecked:false
		}
	]



	var Toto = React.createClass({
		getInitialState:function(){
			return {
				data: this.props.data,
			}
		},
		render: function(){
			var num = 0;
			for ( var i=0; i<this.props.data.length; i++ ) {
				if ( this.props.data[i] && this.props.data[i].isChecked ) {
					num ++;
				}
			};
			return (
				<div>
					<Header that={this} />
					<List count={num} data={this.props.data} that={this} />
					<Footer count={num} />
				</div>
			)
		}
	});
	
	var Header = React.createClass({
		keyDown: function(ev){
			if ( ev.keyCode === 13 ) {
				this.props.that.state.data.unshift({
					id: new Date().getTime() + Math.random(),
					title:ev.target.value,
					isChecked:false
				})
				this.props.that.setState({
					data: this.props.that.state.data
				})
				ev.target.value = '';
			}
		},
		render:function(){
			return (
				<header className="header" >
	                <h1>todos</h1>
	                <input className="new-todo" onKeyDown={this.keyDown} defaultValue='' placeholder="请输入内容" />
	            </header>
			)
		}
	});
	var List = React.createClass({
		render:function() {
			return (
				<section className="main">
					<AllChecked count={this.props.count}  that={this.props.that} />
	                <ul className="todo-list">
	                  {
	                  	this.props.data.map(function(item,i){
	                  		return <Li key={i} that={this.props.that} index={i}/>
	                  	}.bind(this))
	                  }
	                </ul>
	            </section>
				
			)
		}
	});
	var AllChecked = React.createClass({
		change: function(ev) {
			this.props.that.state.data.map(function(item,i){
				item.isChecked = ev.target.checked;
			}) 
			this.props.that.setState({
				data: this.props.that.state.data
			})
		},
		render: function() {
			var c = (this.props.count === this.props.that.state.data.length? true: false);
			return (
				<input className="toggle-all" type="checkbox" checked={c} onChange={this.change} />
			);
		}
	})
	var Li = React.createClass({
		change: function() {
			this.props.that.state.data[this.props.index].isChecked = !this.props.that.state.data[this.props.index].isChecked;
			this.props.that.setState({
				data: this.props.that.state.data
			})
		},
		delClick:function(){
			delete this.props.that.state.data[this.props.index];
			this.props.that.setState({
				data: this.props.that.state.data
			})
		},
		render: function() {
			var obj = this.props.that.state.data[this.props.index];
			var c = obj.isChecked? true: false;
			return (
				<li className={obj.isChecked?'completed': ''}>
                    <div className="view">
                        <input className="toggle" onChange={this.change} type="checkbox" checked={c}/>
                        <label>{obj.title}</label>
                        <button onClick={this.delClick} className="destroy"></button>
                    </div>
                </li>
			);
		}
	})
	var Footer = React.createClass({
		render: function() {
			return (
				<footer className="footer">
		            <span className="todo-count">
		            	<strong>{this.props.count}</strong>
		            	<span>条未选中</span>
		            </span>
	           </footer>
			);
		}
	})
	
	
	
	
	ReactDOM.render(<Toto data={data} />,document.getElementById('box'));
</script>
   
</body>

</html>
